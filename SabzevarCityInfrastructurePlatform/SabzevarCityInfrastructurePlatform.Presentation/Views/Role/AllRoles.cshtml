@model IEnumerable<_0_Framework.DTO.RoleViewModel>

@{
    ViewData["title"] = "مدیریت سطوح دسترسی";
}

<div class="card mb-5 mb-xl-8">
    <!--begin::Header-->
    <div class="card-header border-0 pt-5">
        <h3 class="card-title align-items-start flex-column">
            <span class="card-label fw-bold fs-3 mb-1">لیست سطوح دسترسی</span>
        </h3>
        <div class="card-toolbar">
            <button id="AddRoleModalTrigger" class="btn btn-sm btn-light-primary">
                <i class="ki-duotone ki-plus fs-2"></i>سطح دسترسی جدید
            </button>
        </div>
    </div>
    <!--end::Header-->
    <!--begin::Body-->
    <div class="card-body py-3">
        <!--begin::Table container-->
        <div class="table-responsive">
            <!--begin::Table-->
            <table class="table align-middle gs-0 gy-4">
                <!--begin::Table head-->
                <thead>
                    <tr class="fw-bold text-muted bg-light">
                        <th class="ps-4 min-w-125px rounded-start">نام سطح دسترسی</th>
                        <th class="ps-4 min-w-125px rounded-start">تعداد کاربران</th>
                        <th class="min-w-125px text-end rounded-end"> عملیات</th>
                    </tr>
                </thead>
                <!--end::Table head-->
                <!--begin::Table body-->
                <tbody>

                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="d-flex justify-content-start flex-column">
                                        <span class="text-gray-900 fw-bold text-hover-primary mb-1 fs-6">@item.Name</span>
                                    </div>
                                </div>
                            </td>

                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="d-flex justify-content-start flex-column">
                                        <span class="text-gray-900 fw-bold text-hover-primary mb-1 fs-6">@item.UserCount کاربر</span>
                                    </div>
                                </div>
                            </td>


                            <td class="text-end">
                                <button class="btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1 EditRoleModalTrigger" data-id="@item.Id">
                                    <i class="fa fa-edit fs-2"></i>
                                </button>
                                @if (item.Name != "پیش فرض")
                                {
                                    <button data-url="/DeleteRole/@item.Id" class="btn btn-icon btn-bg-light btn-active-color-primary btn-sm delete-button">
                                        <i class="fa fa-trash fs-2"></i>
                                    </button>
                                }
                            </td>
                        </tr>
                    }


                </tbody>
                <!--end::Table body-->
            </table>
            <!--end::Table-->
        </div>
        <!--end::Table container-->
    </div>
    <!--begin::Body-->
</div>


<div class="modal fade" id="AddRoleModal" tabindex="-1" aria-hidden="true" style="display: none;">
</div>

<div class="modal fade" id="UpdateRoleModal" tabindex="-1" aria-hidden="true" style="display: none;">
</div>


@section scripts
{
    <script>
        $(document).ready(function () {
            // Event listener for the button click
            $('#AddRoleModalTrigger').click(function (event) {
                // Prevent default behavior (link navigation)
                event.preventDefault();

                // Get the data-id attribute from the button
                //var id = $(this).data('id');

                // Make an AJAX request to load the partial view
                $.ajax({
                    url: '@Url.Action("AddRole", "Role")', // Replace with your controller name
                    type: 'GET',
                    success: function (result) {
                        // Inject the partial view content into the modal body
                        $('#AddRoleModal').html(result);
                        // Show the modal
                        $('#AddRoleModal').modal('show');
                    },
                    error: function (xhr, status, error) {
                        console.error(error);
                    }
                });
            });


            $('.EditRoleModalTrigger').click(function (event) {
                // Prevent default behavior (link navigation)
                event.preventDefault();

                // Get the data-id attribute from the button
                var id = $(this).data('id');

                // Make an AJAX request to load the partial view
                $.ajax({
                    url: "/UpdateRole/" + id, // Replace with your controller name
                    type: 'GET',
                    success: function (result) {
                        // Inject the partial view content into the modal body
                        $('#UpdateRoleModal').html(result);
                        // Show the modal
                        $('#UpdateRoleModal').modal('show');
                    },
                    error: function (xhr, status, error) {
                        console.error(error);
                    }
                });
            });
        });
    </script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Select all delete buttons
            const deleteButtons = document.querySelectorAll('.delete-button');

            deleteButtons.forEach(button => {
                button.addEventListener('click', function(event) {
                    event.preventDefault(); 
        
                    const deleteUrl = this.getAttribute('data-url');

                    Swal.fire({
                        title: 'آیا از حذف سطح دسترسی مطمئن هستید ؟',
                        text: "در صورت وجود کاربر با این سطح دسترسی ، به سطح دسترسی پیش فرض تغییر خواهد کرد.",
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#d33',
                        cancelButtonColor: '#3085d6',
                        confirmButtonText: 'بله ؛ حذف کن!',
                        cancelButtonText: 'منصرف شدم'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            window.location.href = deleteUrl;
                        }
                    });
                });
            });
        });
    </script>

}
